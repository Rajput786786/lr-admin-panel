<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LR CONTROL PANEL</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LR CONTROL PANEL</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{margin:0;font-family:Arial;background:linear-gradient(135deg,#050510,#0f0f1f);color:white;}
.title{text-align:center;font-size:32px;font-weight:bold;color:#00ffff;text-shadow:0 0 15px #00ffff;margin:25px 0;}
.glass{background:rgba(255,255,255,0.05);backdrop-filter:blur(15px);border:1px solid rgba(0,255,255,0.2);
box-shadow:0 0 30px rgba(0,255,255,0.15);border-radius:18px;padding:25px;margin-bottom:30px;}
input,select{width:100%;padding:12px;margin:8px 0;background:transparent;border:none;
border-bottom:2px solid #00ffff;color:white;outline:none;}
button{padding:10px 18px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;margin:5px;}
.btn-primary{background:#00ffff;color:black;}
.btn-danger{background:red;color:white;}
.btn-block{background:#888;color:black;}
.btn-logout{background:red;color:white;float:right;}
.hidden{display:none;}
table{width:100%;margin-top:15px;border-collapse:collapse;}
th,td{padding:8px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.1);font-size:13px;}
.green{color:#00ff9d;} .red{color:red;} .blue{color:#00ccff;}
.admin-box{margin-top:25px;padding:20px;border-radius:15px;background:rgba(0,0,0,0.4);
border:1px solid rgba(0,255,255,0.3);}
.balance{float:right;color:#00ff9d;font-weight:bold;}
.clear{clear:both;}
</style>
</head>

<body>

<div class="title">LR CONTROL PANEL</div>

<div id="loginBox" class="glass" style="max-width:400px;margin:50px auto;">
<input type="email" id="loginEmail" placeholder="Email">
<input type="password" id="loginPassword" placeholder="Password">
<button id="loginBtn" class="btn-primary">LOGIN</button>
</div>

<div id="panel" class="hidden" style="max-width:1200px;margin:auto;">
<button class="btn-logout" onclick="logout()">LOG OUT</button>
<div class="clear"></div>

<div id="ownerSection"></div>
<div id="adminSections"></div>

<div id="addAdminBox" class="glass hidden">
<h3>Add New Admin</h3>
<input type="email" id="newEmail" placeholder="Admin Email">
<input type="password" id="newPassword" placeholder="Admin Password">
<button id="addAdminBtn" class="btn-primary">CREATE ADMIN</button>
</div>

</div>

<script>

const supabaseClient = window.supabase.createClient(
"https://dpskhodrzlnqczibolug.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRwc2tob2RyemxucWN6aWJvbHVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwMjU1MTcsImV4cCI6MjA4NzYwMTUxN30.53CxPWtg_-PpDt_reNsxE1A4KupdhFfv6wbB3HsuhNs"
);

let currentUser=null;
let currentProfile=null;

/* LOGIN */
document.getElementById("loginBtn").addEventListener("click", async ()=>{
const email=document.getElementById("loginEmail").value.trim();
const password=document.getElementById("loginPassword").value.trim();
if(!email||!password){alert("Enter Email & Password");return;}
const {error}=await supabaseClient.auth.signInWithPassword({email,password});
if(error){alert(error.message);return;}
initSession();
});

supabaseClient.auth.getSession().then(({data})=>{
if(data.session) initSession();
});

async function initSession(){
const {data:{user}}=await supabaseClient.auth.getUser();
currentUser=user;
const {data,error}=await supabaseClient.from("profiles")
.select("*").eq("id",user.id).single();
if(error){alert("Profile not found");return;}
if(data.status==="blocked"){alert("You are blocked");await logout();return;}
currentProfile=data;
loginBox.classList.add("hidden");
panel.classList.remove("hidden");
loadPanel();
}

async function logout(){
await supabaseClient.auth.signOut();
location.reload();
}

function isExpired(d){return new Date(d)<new Date();}
function randomKey(){return "LR-"+Math.floor(100000+Math.random()*900000);}

/* PANEL LOAD */
async function loadPanel(){
ownerSection.innerHTML="";
adminSections.innerHTML="";
if(currentProfile.role==="owner"){
addAdminBox.classList.remove("hidden");
await loadOwnerSection();
await loadAdmins();
}else{
addAdminBox.classList.add("hidden");
await loadAdminOwn();
}
}

/* OWNER SECTION */
async function loadOwnerSection(){
const {data}=await supabaseClient.from("license_keys")
.select("*").eq("created_by",currentUser.id)
.order("id",{ascending:false});

let html=`<div class="glass"><h3>Owner Keys</h3>
${generateSectionHTML("owner")}
<table>
<tr><th>User</th><th>Key</th><th>Expire</th><th>Status</th><th>Action</th></tr>`;

data.forEach(k=>{
let expired=isExpired(k.expire_date);
let status=expired?"Expired":k.status;
let cls=expired?"blue":(k.status==="Active"?"green":"red");
html+=`<tr>
<td>${k.username}</td>
<td>${k.license_key}</td>
<td>${expired?"Expired":new Date(k.expire_date).toLocaleString()}</td>
<td class="${cls}">${status}</td>
<td>
<button class="btn-block" onclick="toggleKey(${k.id},'${k.status}')">
${k.status==="Active"?"Block":"Unblock"}
</button>
<button class="btn-danger" onclick="deleteKey(${k.id})">Delete</button>
</td></tr>`;
});

html+="</table></div>";
ownerSection.innerHTML=html;
}

/* ADMIN OWN */
async function loadAdminOwn(){
const {data}=await supabaseClient.from("license_keys")
.select("*").eq("created_by",currentUser.id)
.order("id",{ascending:false});

let html=`<div class="glass"><h3>Your Keys</h3>
${generateSectionHTML("admin")}
<table>
<tr><th>User</th><th>Key</th><th>Expire</th><th>Status</th><th>Action</th></tr>`;

data.forEach(k=>{
let expired=isExpired(k.expire_date);
let status=expired?"Expired":k.status;
let cls=expired?"blue":(k.status==="Active"?"green":"red");
html+=`<tr>
<td>${k.username}</td>
<td>${k.license_key}</td>
<td>${expired?"Expired":new Date(k.expire_date).toLocaleString()}</td>
<td class="${cls}">${status}</td>
<td>
<button class="btn-block" onclick="toggleKey(${k.id},'${k.status}')">
${k.status==="Active"?"Block":"Unblock"}
</button>
<button class="btn-danger" onclick="deleteKey(${k.id})">Delete</button>
</td></tr>`;
});

html+="</table></div>";
adminSections.innerHTML=html;
}

/* GENERATE SECTION */
function generateSectionHTML(type){
return `
<h4>Generate Key</h4>
<input type="text" id="gUser_${type}" placeholder="Username">
<input type="text" id="gManual_${type}" placeholder="Manual Key (Optional)">
<input type="number" id="gValidity_${type}" placeholder="Validity">
<select id="gType_${type}">
<option value="days">Days</option>
<option value="hours">Hours</option>
</select>
<button class="btn-primary" onclick="generateKey('${type}')">Generate</button>
`;
}

async function generateKey(type){
const username=document.getElementById(`gUser_${type}`).value.trim();
const manual=document.getElementById(`gManual_${type}`).value.trim();
const validity=parseInt(document.getElementById(`gValidity_${type}`).value);
const vtype=document.getElementById(`gType_${type}`).value;

if(!username||!validity){alert("Fill fields");return;}

let key=manual||randomKey();
let expire=new Date();
if(vtype==="days") expire.setDate(expire.getDate()+validity);
else expire.setHours(expire.getHours()+validity);

await supabaseClient.from("license_keys").insert([{
username,
license_key:key,
expire_date:expire.toISOString(),
status:"Active",
created_by:currentUser.id
}]);

loadPanel();
}

/* TOGGLE KEY */
async function toggleKey(id,status){
let newStatus=status==="Active"?"Blocked":"Active";
await supabaseClient.from("license_keys")
.update({status:newStatus}).eq("id",id);
loadPanel();
}

/* DELETE KEY */
async function deleteKey(id){
if(!confirm("Delete?"))return;
await supabaseClient.from("license_keys")
.delete().eq("id",id);
loadPanel();
}

/* LOAD ADMINS (OWNER ONLY) */
async function loadAdmins(){
const {data}=await supabaseClient.from("profiles")
.select("*").eq("role","admin");

for(let admin of data){
const {data:keys}=await supabaseClient.from("license_keys")
.select("*").eq("created_by",admin.id);

let box=`<div class="admin-box">
<b>${admin.email}</b>
<span class="balance">₹${admin.balance}</span><br><br>`;

keys.forEach(k=>{
let expired=isExpired(k.expire_date);
let status=expired?"Expired":k.status;
let cls=expired?"blue":(k.status==="Active"?"green":"red");
box+=`<div>
${k.username} | ${k.license_key} |
<span class="${cls}">${status}</span>
<button class="btn-block" onclick="toggleKey(${k.id},'${k.status}')">
${k.status==="Active"?"Block":"Unblock"}
</button>
<button class="btn-danger" onclick="deleteKey(${k.id})">Delete</button>
</div>`;
});

box+=`<br>
<button class="btn-block" onclick="toggleAdmin('${admin.id}','${admin.status}')">
${admin.status==="blocked"?"Unblock":"Block"}
</button>
<button class="btn-danger" onclick="deleteAdmin('${admin.id}')">Delete</button>
</div>`;

adminSections.innerHTML+=box;
}
}

/* TOGGLE ADMIN */
async function toggleAdmin(id,status){
let newStatus=status==="blocked"?"active":"blocked";
await supabaseClient.from("profiles")
.update({status:newStatus}).eq("id",id);
if(newStatus==="blocked"){
await supabaseClient.from("license_keys")
.update({status:"Blocked"}).eq("created_by",id);
}
loadPanel();
}

/* DELETE ADMIN */
async function deleteAdmin(adminId){
if(!confirm("Delete Admin?"))return;
const {data:session}=await supabaseClient.auth.getSession();
await fetch("https://dpskhodrzlnqczibolug.supabase.co/functions/v1/delete-admin",{
method:"POST",
headers:{
"Content-Type":"application/json",
"Authorization":"Bearer "+session.session.access_token
},
body:JSON.stringify({admin_id:adminId})
});
loadPanel();
}

/* ADD ADMIN */
document.getElementById("addAdminBtn").addEventListener("click", async ()=>{
const email=document.getElementById("newEmail").value.trim();
const password=document.getElementById("newPassword").value.trim();
if(!email||!password){alert("Fill fields");return;}

const {data:exist}=await supabaseClient.from("profiles")
.select("*").eq("email",email);

if(exist.length>0){alert("Admin already exists");return;}

const {data,error}=await supabaseClient.auth.signUp({email,password});
if(error){alert(error.message);return;}

await supabaseClient.from("profiles").insert([{
id:data.user.id,
email,
role:"admin",
balance:1000,
status:"active"
}]);

alert("Admin Added");
loadPanel();
});

</script>
</body>
</html>￼Enter
<style>
body{margin:0;font-family:Arial;background:linear-gradient(135deg,#050510,#0f0f1f);color:white;}
.title{text-align:center;font-size:32px;font-weight:bold;color:#00ffff;text-shadow:0 0 15px #00ffff;margin:25px 0;}
.glass{background:rgba(255,255,255,0.05);backdrop-filter:blur(15px);border:1px solid rgba(0,255,255,0.2);
box-shadow:0 0 30px rgba(0,255,255,0.15);border-radius:18px;padding:25px;margin-bottom:30px;}
input,select{width:100%;padding:12px;margin:8px 0;background:transparent;border:none;
border-bottom:2px solid #00ffff;color:white;outline:none;}
button{padding:10px 18px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;margin:5px;}
.btn-primary{background:#00ffff;color:black;}
.btn-danger{background:red;color:white;}
.btn-block{background:#888;color:black;}
.btn-logout{background:red;color:white;float:right;}
.hidden{display:none;}
table{width:100%;margin-top:15px;border-collapse:collapse;}
th,td{padding:8px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.1);font-size:13px;}
.green{color:#00ff9d;} .red{color:red;} .blue{color:#00ccff;}
.admin-box{margin-top:25px;padding:20px;border-radius:15px;background:rgba(0,0,0,0.4);
border:1px solid rgba(0,255,255,0.3);}
.balance{float:right;color:#00ff9d;font-weight:bold;}
.clear{clear:both;}
</style>
</head>

<body>

<div class="title">LR CONTROL PANEL</div>

<div id="loginBox" class="glass" style="max-width:400px;margin:50px auto;">
<input type="email" id="loginEmail" placeholder="Email">
<input type="password" id="loginPassword" placeholder="Password">
<button id="loginBtn" class="btn-primary">LOGIN</button>
</div>

<div id="panel" class="hidden" style="max-width:1200px;margin:auto;">
<button class="btn-logout" onclick="logout()">LOG OUT</button>
<div class="clear"></div>

<div id="ownerSection"></div>
<div id="adminSections"></div>

<div id="addAdminBox" class="glass hidden">
<h3>Add New Admin</h3>
<input type="email" id="newEmail" placeholder="Admin Email">
<input type="password" id="newPassword" placeholder="Admin Password">
<button id="addAdminBtn" class="btn-primary">CREATE ADMIN</button>
</div>

</div>

<script>

const supabaseClient = window.supabase.createClient(
"https://dpskhodrzlnqczibolug.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRwc2tob2RyemxucWN6aWJvbHVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwMjU1MTcsImV4cCI6MjA4NzYwMTUxN30.53CxPWtg_-PpDt_reNsxE1A4KupdhFfv6wbB3HsuhNs"
);

let currentUser=null;
let currentProfile=null;

/* LOGIN */
document.getElementById("loginBtn").addEventListener("click", async ()=>{
const email=document.getElementById("loginEmail").value.trim();
const password=document.getElementById("loginPassword").value.trim();
if(!email||!password){alert("Enter Email & Password");return;}
const {error}=await supabaseClient.auth.signInWithPassword({email,password});
if(error){alert(error.message);return;}
initSession();
});

supabaseClient.auth.getSession().then(({data})=>{
if(data.session) initSession();
});

async function initSession(){
const {data:{user}}=await supabaseClient.auth.getUser();
currentUser=user;
const {data,error}=await supabaseClient.from("profiles")
.select("*").eq("id",user.id).single();
if(error){alert("Profile not found");return;}
if(data.status==="blocked"){alert("You are blocked");await logout();return;}
currentProfile=data;
loginBox.classList.add("hidden");
panel.classList.remove("hidden");
loadPanel();
}

async function logout(){
await supabaseClient.auth.signOut();
location.reload();
}

function isExpired(d){return new Date(d)<new Date();}
function randomKey(){return "LR-"+Math.floor(100000+Math.random()*900000);}

/* PANEL LOAD */
async function loadPanel(){
ownerSection.innerHTML="";
adminSections.innerHTML="";
if(currentProfile.role==="owner"){
addAdminBox.classList.remove("hidden");
await loadOwnerSection();
await loadAdmins();
}else{
addAdminBox.classList.add("hidden");
await loadAdminOwn();
}
OWNER SECTION */
async function loadOwnerSection(){
const {data}=await supabaseClient.from("license_keys")
.select("*").eq("created_by",currentUser.id)
.order("id",{ascending:false});

let html=`<div class="glass"><h3>Owner Keys</h3>
${generateSectionHTML("owner")}
<table>
<tr><th>User</th><th>Key</th><th>Expire</th><th>Status</th><th>Action</th></tr>`;

data.forEach(k=>{
let expired=isExpired(k.expire_date);
let status=expired?"Expired":k.status;
let cls=expired?"blue":(k.status==="Active"?"green":"red");
html+=`<tr>
<td>${k.username}</td>
<td>${k.license_key}</td>
<td>${expired?"Expired":new Date(k.expire_date).toLocaleString()}</td>
<td class="${cls}">${status}</td>
<td>
<button class="btn-block" onclick="toggleKey(${k.id},'${k.status}')">
${k.status==="Active"?"Block":"Unblock"}
</button>
<button class="btn-danger" onclick="deleteKey(${k.id})">Delete</button>
</td></tr>`;
});

html+="</table></div>";
ownerSection.innerHTML=html;
}

/* ADMIN OWN */
async function loadAdminOwn(){
const {data}=await supabaseClient.from("license_keys")
.select("*").eq("created_by",currentUser.id)
.order("id",{ascending:false});

let html=`<div class="glass"><h3>Your Keys</h3>
${generateSectionHTML("admin")}
<table>
<tr><th>User</th><th>Key</th><th>Expire</th><th>Status</th><th>Action</th></tr>`;

data.forEach(k=>{
let expired=isExpired(k.expire_date);
let status=expired?"Expired":k.status;
let cls=expired?"blue":(k.status==="Active"?"green":"red");
html+=`<tr>
<td>${k.username}</td>
<td>${k.license_key}</td>
<td>${expired?"Expired":new Date(k.expire_date).toLocaleString()}</td>
<td class="${cls}">${status}</td>
<td>
<button class="btn-block" onclick="toggleKey(${k.id},'${k.status}')">
${k.status==="Active"?"Block":"Unblock"}
</button>
<button class="btn-danger" onclick="deleteKey(${k.id})">Delete</button>
</td></tr>`;
});

html+="</table></div>";
adminSections.innerHTML=html;
}

/* GENERATE SECTION */
function generateSectionHTML(type){
return `
<h4>Generate Key</h4>
<input type="text" id="gUser_${type}" placeholder="Username">
<input type="text" id="gManual_${type}" placeholder="Manual Key (Optional)">
<input type="number" id="gValidity_${type}" placeholder="Validity">
<select id="gType_${type}">
<option value="days">Days</option>
<option value="hours">Hours</option>
</select>
<button class="btn-primary" onclick="generateKey('${type}')">Generate</button>
`;
}

async function generateKey(type){
const username=document.getElementById(`gUser_${type}`).value.trim();
const manual=document.getElementById(`gManual_${type}`).value.trim();
const validity=parseInt(document.getElementById(`gValidity_${type}`).value);
const vtype=document.getElementById(`gType_${type}`).value;

if(!username||!validity){alert("Fill fields");return;}

let key=manual||randomKey();
let expire=new Date();
if(vtype==="days") expire.setDate(expire.getDate()+validity);
else expire.setHours(expire.getHours()+validity);

await supabaseClient.from("license_keys").insert([{
username,
license_key:key,
expire_date:expire.toISOString(),
status:"Active",
created_by:currentUser.id
}]);

loadPanel();
}

/* TOGGLE KEY */
async function toggleKey(id,status){
