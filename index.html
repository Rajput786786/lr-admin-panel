<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LR OWNER PANEL</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{margin:0;font-family:Arial;background:#0f0f1a;color:white;}
header{padding:20px;text-align:center;font-size:24px;background:#111;color:#00ffff;}
.container{padding:20px;}
.card{background:#1a1a2e;padding:20px;border-radius:10px;margin-bottom:20px;}
input{padding:10px;margin:5px 0;width:100%;border:none;border-radius:5px;}
button{padding:10px;margin-top:10px;border:none;border-radius:5px;font-weight:bold;cursor:pointer;}
.main-btn{width:100%;background:#00ffff;color:black;}
.logout-btn{background:red;color:white;width:100%;}
</style>
</head>

<body>

<header>LR OWNER PANEL</header>

<div class="container">

<div class="card" id="loginSection">
<h3>Login</h3>
<input type="email" id="loginEmail" placeholder="Email">
<input type="password" id="loginPassword" placeholder="Password">
<button class="main-btn" onclick="login()">Login</button>
</div>

<div id="ownerPanel" style="display:none;">
<div class="card">
<h3>OWNER PANEL</h3>
<p id="ownerEmail"></p>
<button class="logout-btn" onclick="logout()">LOG OUT</button>
</div>
</div>

<div id="adminPanel" style="display:none;">
<div class="card">
<h3>ADMIN PANEL</h3>
<p id="adminEmail"></p>
<button class="logout-btn" onclick="logout()">LOG OUT</button>
</div>
</div>

</div>

<script>

const { createClient } = supabase;

const client = createClient(
"https://dpskhodrzlnqczibolug.supabase.co",
"sb_publishable_slJiDSH_dv0jCErcO8j0-A__ebbJItK"
);

// SESSION CHECK
document.addEventListener("DOMContentLoaded", async () => {
const { data } = await client.auth.getSession();
if(data.session){
await checkProfile(data.session.user.id);
}
});

// LOGIN
async function login(){

let email = document.getElementById("loginEmail").value.trim();
let password = document.getElementById("loginPassword").value.trim();

if(!email || !password){
alert("Enter Email & Password");
return;
}

const { data, error } = await client.auth.signInWithPassword({ email, password });

if(error){
alert(error.message);
return;
}

await checkProfile(data.user.id);
}

// CHECK ROLE + BLOCK STATUS
async function checkProfile(userId){

const { data, error } = await client
.from("profiles")
.select("*")
.eq("id", userId)
.single();

if(error || !data){
alert("Profile not found");
await logout();
return;
}

// BLOCK CHECK
if(data.is_blocked === true || data.status !== "active"){
alert("Account Blocked");
await logout();
return;
}

document.getElementById("loginSection").style.display="none";

if(data.role === "owner"){
document.getElementById("ownerPanel").style.display="block";
document.getElementById("ownerEmail").innerText = data.email;
}
else if(data.role === "admin"){
document.getElementById("adminPanel").style.display="block";
document.getElementById("adminEmail").innerText = data.email;
}
else{
alert("Invalid Role");
await logout();
}
}

// LOGOUT
async function logout(){
await client.auth.signOut();
location.reload();
}

</script>

</body>
</html>
