<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LR OWNER ¬∑ ‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡•à‡§®‡§≤</title>
    <!-- Supabase JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        body {
            min-height: 100vh;
            background: linear-gradient(145deg, #0b0f1c 0%, #141b33 100%);
            color: #eef2ff;
            padding: 24px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            max-width: 1400px;
            width: 100%;
        }
        .glass {
            background: rgba(18, 25, 45, 0.65);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border: 1px solid rgba(0, 255, 255, 0.25);
            border-radius: 32px;
            box-shadow: 0 20px 40px rgba(0, 255, 255, 0.08), 0 0 0 1px rgba(0, 255, 255, 0.1) inset;
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px 28px;
            margin-bottom: 32px;
            background: rgba(8, 18, 38, 0.7);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 60px;
        }
        h1 {
            font-weight: 500;
            font-size: 1.8rem;
            letter-spacing: 1px;
            background: linear-gradient(130deg, #b3f0ff, #5ce0ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 12px cyan;
        }
        .logout-btn {
            background: rgba(255, 60, 60, 0.15);
            border: 1px solid #ff4d4d;
            color: #ffb3b3;
            padding: 10px 26px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 1rem;
            backdrop-filter: blur(8px);
            cursor: pointer;
            transition: 0.25s;
            box-shadow: 0 0 10px #ff000040;
        }
        .logout-btn:hover {
            background: #ff3b3b30;
            color: white;
            border-color: #ff9999;
        }
        .role-badge {
            display: inline-block;
            background: #00ccff20;
            border: 1px solid #0cf;
            border-radius: 30px;
            padding: 6px 18px;
            font-size: 0.9rem;
            font-weight: 500;
            color: #9feaff;
        }
        .balance-badge {
            background: #121f3a;
            border-radius: 40px;
            padding: 8px 22px;
            border: 1px solid gold;
            color: #fce38a;
            font-weight: 600;
        }
        .section-title {
            font-size: 1.5rem;
            margin: 28px 0 16px 10px;
            border-left: 8px solid #0cf;
            padding-left: 20px;
            text-shadow: 0 0 6px cyan;
        }
        .admin-card {
            background: rgba(12, 22, 45, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid #0cf30;
            border-radius: 36px;
            padding: 24px 26px;
            margin-bottom: 30px;
            box-shadow: 0 8px 0 rgba(0, 255, 255, 0.1);
        }
        .key-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 14px;
            margin: 20px 0 10px;
        }
        .key-item {
            background: #0f1a2f;
            border-radius: 28px;
            padding: 12px 20px;
            border: 1px solid #2c3f66;
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }
        .status-badge {
            padding: 4px 16px;
            border-radius: 40px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status-active { background: #00a86b30; border: 1px solid #00d09c; color: #b6ffe0; }
        .status-blocked { background: #c41e3a30; border: 1px solid #ff5f7c; color: #ffc0cb; }
        .status-expired { background: #3a4a6b30; border: 1px solid #7f9fcf; color: #b8d1ff; }
        .btn-sm {
            background: none;
            border: 1px solid #4d7090;
            color: #b0d4ff;
            padding: 6px 16px;
            border-radius: 30px;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-sm:hover { background: #1e3f6e; border-color: cyan; color: white; }
        .btn-block { border-color: #ff7878; color: #ffa7a7; }
        .btn-block:hover { background: #a13333; }
        .glass-box-input {
            background: rgba(0, 255, 255, 0.05);
            border: 1px dashed #0cf;
            border-radius: 80px;
            padding: 22px 28px;
            margin-top: 25px;
            text-align: center;
            font-size: 1.2rem;
            color: #9cc;
        }
        hr { border: 0.5px solid #0cf30; margin: 30px 0; opacity: 0.15; }
        .flex-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
        }
        .key-actions { display: flex; gap: 10px; }
        .note { color: #9bb5d9; font-size: 0.85rem; margin-top: 6px; }
        .owner-highlight { border-left: 6px solid gold; padding-left: 16px; }
    </style>
</head>
<body>
<div class="container">

    <!-- header -->
    <div class="header glass">
        <h1>‚ö° LR OWNER ¬∑ ‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡•à‡§®‡§≤</h1>
        <button class="logout-btn" id="logoutBtn">üö™ ‡§≤‡•â‡§ó ‡§Ü‡§â‡§ü</button>
    </div>

    <!-- role based view -->
    <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 30px;">
        <span class="role-badge" id="roleBadge">üëë OWNER (‡§™‡§∞‡§Æ‡§æ‡§®‡•á‡§Ç‡§ü)</span>
        <span class="balance-badge" id="balanceDisplay">üí∞ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏: ‚àû</span>
    </div>

    <!-- OWNER KEYS SECTION -->
    <div class="section-title">üîë OWNER KEYS</div>
    <div class="admin-card">
        <div class="key-grid" id="ownerKeysContainer">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>
        <div class="flex-row" style="margin-top: 20px;">
            <span>‚öôÔ∏è ‡§ú‡•á‡§®‡§∞‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç ‚Äî ‡§¶‡§ø‡§®/‡§ò‡§Ç‡§ü‡§æ</span>
            <div>
                <button class="btn-sm" id="genOwnerDay">+ ‡§¶‡§ø‡§® (‚Çπ100)</button>
                <button class="btn-sm" id="genOwnerHour">+ ‡§ò‡§Ç‡§ü‡§æ (‚Çπ10)</button>
            </div>
        </div>
        <div class="note">‚úÖ Owner ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏ ‡§ï‡§ü‡•å‡§§‡•Ä ‡§®‡§π‡•Ä‡§Ç</div>
    </div>

    <!-- ADMINS SECTION -->
    <div class="section-title">üë• ‡§è‡§°‡§Æ‡§ø‡§® ‡§∏‡•á‡§ï‡•ç‡§∂‡§®</div>
    <div id="adminsContainer">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>

    <!-- ADD NEW ADMIN -->
    <div class="glass-box-input">
        ‚ûï ‡§®‡§Ø‡§æ ‡§è‡§°‡§Æ‡§ø‡§® ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
        <div style="margin-top: 12px;">
            <input type="email" placeholder="admin@email.com" id="newAdminEmail" style="background:#111c33; border:1px solid cyan; border-radius:40px; padding:12px 20px; width:260px; color:white;">
            <button class="btn-sm" id="addAdminBtn">‡§ê‡§° ‡§ï‡§∞‡•á‡§Ç</button>
        </div>
    </div>

    <hr>
    <div style="text-align: center; opacity:0.6;">master locked rules ‚Ä¢ ‡§∏‡•Å‡§™‡•ç‡§∞‡§æ‡§¨‡•á‡§∏ ‡§∏‡•á ‡§ï‡§®‡•á‡§ï‡•ç‡§ü‡•á‡§°</div>
</div>

<script>
    (function() {
        // ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§∞‡•Ä ‡§¶‡•Ä ‡§π‡•Å‡§à Supabase keys
        const SUPABASE_URL = 'https://dpskhodrzlnqczibolug.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRwc2tob2RyemxucWN6aWJvbHVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwMjU1MTcsImV4cCI6MjA4NzYwMTUxN30.53CxPWtg_-PpDt_reNsxE1A4KupdhFfv6wbB3HsuhNs';

        // ‡§∏‡•Å‡§™‡•ç‡§∞‡§æ‡§¨‡•á‡§∏ ‡§á‡§®‡§ø‡§∂‡§ø‡§Ø‡§≤‡§æ‡§á‡§ú‡§º
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // ‡§ó‡•ç‡§≤‡•ã‡§¨‡§≤ ‡§µ‡•á‡§∞‡§ø‡§è‡§¨‡§≤
        let currentUser = null; // ‡§≤‡•â‡§ó‡§ø‡§® ‡§Ø‡•Ç‡§ú‡§∞
        let allAdmins = [];
        let allKeys = [];

        // ‡§°‡•á‡§Æ‡•ã ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ì‡§®‡§∞ ‡§∏‡•á‡§ü (‡§Ö‡§∏‡§≤ ‡§Æ‡•á‡§Ç ‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡•á ‡§Ü‡§è‡§ó‡§æ)
        // ‡§´‡§ø‡§≤‡§π‡§æ‡§≤ ‡§ì‡§®‡§∞ ‡§Æ‡§æ‡§®‡§ï‡§∞ ‡§ö‡§≤ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç
        const DEMO_OWNER = {
            id: 'owner-id',
            email: 'owner@lrpanel.com',
            role: 'owner',
            balance: Infinity,
            is_blocked: false
        };

        // ‡§á‡§®‡§ø‡§∂‡§ø‡§Ø‡§≤ ‡§≤‡•ã‡§°
        window.addEventListener('DOMContentLoaded', async () => {
            await loadData();
        });

        async function loadData() {
            try {
                // 1. ‡§∏‡§æ‡§∞‡•á ‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•ã (‡§è‡§°‡§Æ‡§ø‡§® + ‡§ì‡§®‡§∞)
                const { data: profiles, error: profilesError } = await supabase
                    .from('profiles')
                    .select('*');
                
                if (profilesError) throw profilesError;

                // ‡§ì‡§®‡§∞ ‡§î‡§∞ ‡§è‡§°‡§Æ‡§ø‡§® ‡§Ö‡§≤‡§ó
                const owner = profiles.find(p => p.role === 'owner') || DEMO_OWNER;
                const admins = profiles.filter(p => p.role === 'admin');

                // 2. ‡§∏‡§æ‡§∞‡•Ä keys ‡§≤‡•ã‡§° ‡§ï‡§∞‡•ã
                const { data: keys, error: keysError } = await supabase
                    .from('license_keys')
                    .select('*');
                
                if (keysError) throw keysError;

                // ‡§ó‡•ç‡§≤‡•ã‡§¨‡§≤ ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ
                allAdmins = admins;
                allKeys = keys || [];

                // ‡§∞‡•á‡§Ç‡§°‡§∞ ‡§ï‡§∞‡•ã
                renderOwnerKeys(owner, keys);
                renderAdmins(admins, keys);

                // role badge update (‡§°‡•á‡§Æ‡•ã)
                document.getElementById('roleBadge').innerHTML = 'üëë OWNER (‡§™‡§∞‡§Æ‡§æ‡§®‡•á‡§Ç‡§ü)';
                document.getElementById('balanceDisplay').innerHTML = 'üí∞ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏: ‚àû';

            } catch (error) {
                console.error('‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° error:', error);
                alert('‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§™‡§æ‡§Ø‡§æ, ‡§°‡•á‡§Æ‡•ã ‡§Æ‡•ã‡§° ‡§ö‡§æ‡§≤‡•Ç');
                
                // ‡§°‡•á‡§Æ‡•ã ‡§°‡•á‡§ü‡§æ
                fallbackDemoData();
            }
        }

        function renderOwnerKeys(owner, keys) {
            const ownerKeys = keys.filter(k => k.created_by === owner.id);
            const container = document.getElementById('ownerKeysContainer');
            
            if (!ownerKeys.length) {
                container.innerHTML = '<div class="key-item">‡§ï‡•ã‡§à ‡§ì‡§®‡§∞ ‡§ï‡•Å‡§Ç‡§ú‡•Ä ‡§®‡§π‡•Ä‡§Ç</div>';
                return;
            }

            container.innerHTML = '';
            ownerKeys.forEach(k => {
                const div = document.createElement('div');
                div.className = 'key-item';
                div.innerHTML = `
                    <span>${k.username || '‚Äî'}</span>
                    <code>${k.license_key}</code>
                    <span class="status-badge status-${k.status?.toLowerCase()}">${k.status}</span>
                    <span>üìÖ ${new Date(k.expire_date).toLocaleDateString('hi-IN')}</span>
                    <div class="key-actions">
                        <button class="btn-sm btn-block" onclick="alert('‡§¨‡•ç‡§≤‡•â‡§ï ‡§ï‡§∞‡•á‡§Ç (edge function)')">‡§¨‡•ç‡§≤‡•â‡§ï</button>
                        <button class="btn-sm" onclick="alert('‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡•á‡§Ç (edge function)')">‡§°‡§ø‡§≤‡•Ä‡§ü</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function renderAdmins(admins, keys) {
            const container = document.getElementById('adminsContainer');
            if (!admins.length) {
                container.innerHTML = '<div class="glass">‡§ï‡•ã‡§à ‡§è‡§°‡§Æ‡§ø‡§® ‡§®‡§π‡•Ä‡§Ç</div>';
                return;
            }

            container.innerHTML = '';
            admins.forEach(admin => {
                const adminKeys = keys.filter(k => k.created_by === admin.id);
                const total = adminKeys.length;
                const active = adminKeys.filter(k => k.status === 'Active').length;
                const blocked = adminKeys.filter(k => k.status === 'Blocked').length;

                const card = document.createElement('div');
                card.className = 'admin-card';
                card.innerHTML = `
                    <div class="flex-row">
                        <div>
                            üìß ${admin.email}
                            <span class="role-badge" style="margin-left:15px;">${admin.is_blocked ? 'üî¥ ‡§¨‡•ç‡§≤‡•â‡§ï‡•ç‡§°' : 'üü¢ ‡§è‡§°‡§Æ‡§ø‡§®'}</span>
                        </div>
                        <span class="balance-badge">üí∞ ‚Çπ${admin.balance || 0}</span>
                    </div>
                    <div style="margin:12px 0; display:flex; gap:24px;">
                        <span>üîë ‡§ï‡•Å‡§≤: ${total}</span>
                        <span>‚úÖ ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø: ${active}</span>
                        <span>‚õî ‡§¨‡•ç‡§≤‡•â‡§ï‡•ç‡§°: ${blocked}</span>
                    </div>
                    <div class="key-grid" id="keys-${admin.id}"></div>
                    <div style="margin-top:20px;">
                        <button class="btn-sm ${admin.is_blocked ? '' : 'btn-block'}" onclick="alert('‡§¨‡•ç‡§≤‡•â‡§ï/‡§Ö‡§®‡§¨‡•ç‡§≤‡•â‡§ï edge function')">
                            ${admin.is_blocked ? '‡§Ö‡§®‡§¨‡•ç‡§≤‡•â‡§ï' : '‡§¨‡•ç‡§≤‡•â‡§ï'} ‡§è‡§°‡§Æ‡§ø‡§®
                        </button>
                        <button class="btn-sm btn-block" onclick="alert('‡§°‡§ø‡§≤‡•Ä‡§ü edge function ‡§ï‡•â‡§≤ ‡§π‡•ã‡§ó‡§æ')">‡§°‡§ø‡§≤‡•Ä‡§ü ‡§è‡§°‡§Æ‡§ø‡§®</button>
                    </div>
                `;

                // keys render
                const keysContainer = card.querySelector(`#keys-${admin.id}`);
                if (keysContainer) {
                    adminKeys.forEach(k => {
                        const keyEl = document.createElement('div');
                        keyEl.className = 'key-item';
                        keyEl.innerHTML = `
                            <span>${k.username}</span>
                            <code>${k.license_key}</code>
                            <span class="status-badge status-${k.status?.toLowerCase()}">${k.status}</span>
                            <span>üìÖ ${new Date(k.expire_date).toLocaleDateString()}</span>
                        `;
                        keysContainer.appendChild(keyEl);
                    });
                }

                container.appendChild(card);
            });
        }

        function fallbackDemoData() {
            // ‡§°‡•á‡§Æ‡•ã ‡§°‡•á‡§ü‡§æ ‡§ú‡•à‡§∏‡§æ ‡§™‡§π‡§≤‡•á ‡§•‡§æ
            const demoOwner = { id: 'own1', role: 'owner' };
            const demoAdmins = [
                { id: 'a1', email: 'raj@demo.com', balance: 3400, is_blocked: false },
                { id: 'a2', email: 'neha@demo.com', balance: 720, is_blocked: false }
            ];
            const demoKeys = [
                { id: 1, username: 'user1', license_key: 'KEY1', expire_date: '2025-06-15', status: 'Active', created_by: 'own1' },
                { id: 2, username: 'user2', license_key: 'KEY2', expire_date: '2025-07-01', status: 'Active', created_by: 'a1' }
            ];
            renderOwnerKeys(demoOwner, demoKeys);
            renderAdmins(demoAdmins, demoKeys);
        }

        // ‡§¨‡§ü‡§® ‡§á‡§µ‡•á‡§Ç‡§ü‡•ç‡§∏ (edge functions ‡§∏‡•á ‡§ú‡•ã‡§°‡§º‡§®‡§æ ‡§¨‡§æ‡§ï‡•Ä)
        document.getElementById('genOwnerDay').addEventListener('click', () => {
            alert('Owner day key generate (edge function)');
        });
        document.getElementById('genOwnerHour').addEventListener('click', () => {
            alert('Owner hour key generate (edge function)');
        });
        document.getElementById('addAdminBtn').addEventListener('click', () => {
            const email = document.getElementById('newAdminEmail').value;
            alert(`‡§è‡§°‡§Æ‡§ø‡§® ‡§ê‡§°: ${email} (edge function call)`);
        });
        document.getElementById('logoutBtn').addEventListener('click', () => {
            alert('‡§≤‡•â‡§ó‡§Ü‡§â‡§ü');
        });

    })();
</script>
</body>
</html>
